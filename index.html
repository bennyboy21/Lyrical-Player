<!-- Newest Stuff -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spotify Lyrics Viewer</title>
</head>
<body>
  <h1>Spotify Lyrics Viewer</h1>
  <button id="login">Login with Spotify</button>
  <h2 id="track"></h2>
  <pre id="lyrics"></pre>

  <script>
    const clientId = "86d5980bc6284ccba0515e63ddd32845"; // Replace with your own
    const redirectUri = window.location.origin + "/Lyrical-Player/"; // GitHub Pages URL
    const scopes = "user-read-currently-playing user-read-playback-state";

    // Login button click â†’ redirect to Spotify auth
    document.getElementById("login").addEventListener("click", () => {
      const authUrl =
        "https://accounts.spotify.com/authorize?" +
        new URLSearchParams({
          response_type: "token", // ðŸ‘ˆ Implicit Grant
          client_id: clientId,
          scope: scopes,
          redirect_uri: redirectUri,
        });
      window.location.href = authUrl;
    });

    // Extract access_token from hash after redirect
    function getAccessTokenFromUrl() {
      if (window.location.hash) {
        return window.location.hash
          .substring(1)
          .split("&")
          .reduce((acc, cur) => {
            const [key, val] = cur.split("=");
            acc[key] = decodeURIComponent(val);
            return acc;
          }, {}).access_token;
      }
      return null;
    }

    const accessToken = getAccessTokenFromUrl();

    async function getCurrentTrack() {
      if (!accessToken) return;

      try {
        const res = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
          headers: { Authorization: "Bearer " + accessToken }
        });

        if (res.status === 204) {
          document.getElementById("track").innerText = "No track currently playing.";
          return;
        }

        const data = await res.json();
        const track = data.item;

        document.getElementById("track").innerText =
          `ðŸŽµ Now Playing: ${track.name} - ${track.artists.map(a => a.name).join(", ")}`;

        // Placeholder for lyrics (can hook Genius later)
        document.getElementById("lyrics").innerText =
          `Lyrics for ${track.name} by ${track.artists[0].name}... (coming soon)`;

      } catch (err) {
        console.error(err);
        document.getElementById("track").innerText = "Error fetching track";
      }
    }

    // If logged in, start polling Spotify every 5s
    if (accessToken) {
      getCurrentTrack();
      setInterval(getCurrentTrack, 5000);
    }
  </script>
</body>
</html>
